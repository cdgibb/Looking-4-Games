<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>L4G - Modify Profile</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .field-label {
      font-weight: bold;
    }
    .readonly-display {
      margin-bottom: 10px;
    }
    .change-password-btn {
      margin-top: 5px;
      padding: 6px 10px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .change-password-btn:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
<header>
  <h1>Modify Profile</h1>
</header>

<nav>
  <ul>
    <li><a href="playerHome.html">Home/Profile</a></li>
    <li><a href="ViewVenueGamesX.html">View Venues/Games</a></li>
  </ul>
</nav>

<main>
  <section>
    <h2>Edit Your Profile</h2>

    <div class="readonly-display">
      <p><span class="field-label">Username:</span> <span id="display-username">...</span></p>
      <p><span class="field-label">Email:</span> <span id="display-email">...</span></p>
      <button class="change-password-btn" onclick="window.location.href='changePassword.html'">Change Password</button>
    </div>

    <form id="profile-form">
      <div>
        <label for="bio">Short Bio:</label>
        <textarea id="bio" name="bio" required></textarea>
      </div>

      <div>
        <label for="location">Location Preferences:</label>
        <input type="text" id="location" name="location" />
      </div>

      <div>
        <label for="distance">Distance Willing to Travel (miles):</label>
        <input type="number" id="distance" name="distance" required min="0" step="0.1" />
      </div>

      <div>
        <label for="gaming-interests">Gaming Interests:</label>
        <textarea
                id="gaming-interests"
                name="gaming-interests"
                rows="4"
                placeholder="Enter your gaming interests here..."
        ></textarea>
      </div>

      <div>
        <button type="submit">Save Changes</button>
      </div>
    </form>
  </section>
</main>

<footer></footer>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const profileForm = document.getElementById("profile-form");
    const player = JSON.parse(localStorage.getItem("player"));

    if (!player) {
      alert("Please log in to edit your profile.");
      window.location.href = "login.html";
      return;
    }

    // Display readonly info
    document.getElementById("display-username").textContent = player.username;
    document.getElementById("display-email").textContent = player.email;

    // Fill editable fields
    document.getElementById("bio").value = player.bio || "";
    document.getElementById("location").value = player.location || "";
    document.getElementById("distance").value = player.distanceWillingToTravel || 0;
    document.getElementById("gaming-interests").value = player.preferredGameStyle || "";

    // Submit changes
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const updatedPlayer = {
        ...player,
        bio: document.getElementById("bio").value,
        location: document.getElementById("location").value,
        preferredGameStyle: document.getElementById("gaming-interests").value,
        distanceWillingToTravel: parseFloat(document.getElementById("distance").value)
      };

      try {
        const response = await fetch(`http://localhost:8080/players/update/${player.playerId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(updatedPlayer)
        });

        if (!response.ok) throw new Error("Failed to update profile");

        const saved = await response.json();
        localStorage.setItem("player", JSON.stringify(saved));

        alert("Profile updated successfully!");
        window.location.href = "playerHome.html";
      } catch (error) {
        console.error("Error:", error);
        alert("There was a problem updating your profile.");
      }
    });
  });
</script>
</body>
</html>
